import { auth } from "./firebaseClientConfig.js";
import {
  GoogleAuthProvider,
  signInWithPopup,
  signInWithRedirect,
  getRedirectResult,
} from "firebase/auth";

const provider = new GoogleAuthProvider();

// ---- Single sign-in handler ----
async function handleGoogleSignIn() {
  try {
    if (/Mobi|Android|iPhone|iPad/i.test(navigator.userAgent)) {
      await signInWithRedirect(auth, provider);
    } else {
      await signInWithPopup(auth, provider);
    }
  } catch (error) {
    console.error("Auth error:", error);
  }
}

// ---- Attach to existing button ----
document.getElementById("googleSignInBtn").addEventListener("click", handleGoogleSignIn);

// ---- Handle redirect result ----
getRedirectResult(auth)
  .then((result) => {
    if (result?.user) {
      console.log("User signed in:", result.user);
      localStorage.setItem("user", JSON.stringify(result.user));
      window.location.href = "/app"; // redirect after login
    }
  })
  .catch((error) => console.error("Redirect error:", error));
